# Редирект с http на https создан автоматически при заказе бесплатного ssl-сертификата
RewriteEngine On
RewriteCond %{SERVER_PORT} !^443$
RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [R,L]
# Конец редиректа

# SPA routing - перенаправление всех запросов на index.html для React Router
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# ===== CACHING STRATEGY =====

# Включаем mod_headers если доступен
<IfModule mod_headers.c>

    # HTML файлы - всегда проверять свежесть (no-cache = можно кэшировать, но надо валидировать)
    <FilesMatch "\.html$">
        Header set Cache-Control "no-cache, must-revalidate"
    </FilesMatch>

    # JS, CSS с хэшем в имени - долгий кэш (1 год), immutable означает "никогда не изменится"
    <FilesMatch "\.(js|css)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # Шрифты - долгий кэш
    <FilesMatch "\.(woff|woff2|ttf|eot|otf)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>

    # Изображения из билда (с хэшем) - долгий кэш
    <FilesMatch "\.(png|jpg|jpeg|gif|svg|webp|ico)$">
        Header set Cache-Control "public, max-age=2592000"
    </FilesMatch>

    # JSON манифесты - короткий кэш
    <FilesMatch "\.(json|webmanifest)$">
        Header set Cache-Control "public, max-age=86400"
    </FilesMatch>

    # PHP скрипты - без кэша
    <FilesMatch "\.php$">
        Header set Cache-Control "no-store, no-cache, must-revalidate"
    </FilesMatch>

</IfModule>

# Сжатие если доступно
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>
